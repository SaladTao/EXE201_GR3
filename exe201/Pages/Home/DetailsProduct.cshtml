@page
@model exe201.Pages.Home.DetailsProductModel

@{
    ViewData["Title"] = "Chi Tiết Sản Phẩm";
    var userId = HttpContext.Session.GetInt32("UserId");
}

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

<style>
    body {
        font-family: 'Inter', sans-serif;
        font-size: 16px;
        color: #333;
        margin-bottom: 60px;
    }

    .product-container {
        max-width: 960px;
        margin: 60px auto;
        background-color: #fff;
        border-radius: 16px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
        padding: 32px;
    }

    .thumbnail-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
        max-height: 500px;
        overflow-y: auto;
        margin-right: 20px;
    }

    .thumbnail-img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border: 2px solid transparent;
        border-radius: 12px;
        cursor: pointer;
        transition: border-color 0.3s ease;
    }

        .thumbnail-img:hover,
        .thumbnail-img.selected {
            border-color: darkorange;
        }

    .main-image {
        max-height: 500px;
        width: 100%;
        object-fit: contain;
        border-radius: 16px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
    }

        .main-image:hover {
            transform: scale(1.05);
        }

    .product-info {
        padding-left: 32px;
    }

    .product-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #1b4332;
        margin-bottom: 0.5rem;
    }

    .price {
        font-size: 1.5rem;
        font-weight: 600;
        color: darkorange;
        margin-bottom: 1rem;
    }

    .category {
        font-weight: 600;
        color: #2d6a4f;
        margin-bottom: 1rem;
    }

    ul.description-list {
        list-style: disc inside;
        color: #444;
        margin-bottom: 1.5rem;
        max-width: 500px;
    }

    label[for="sizeSelect"] {
        font-weight: 600;
        color: #2d6a4f;
    }

    select#sizeSelect {
        max-width: 200px;
        margin-bottom: 1.5rem;
    }

    .btn-add-cart {
        background-color: darkorange;
        font-weight: 700;
        padding: 0.75rem 1.5rem;
        border-radius: 10px;
        border: none;
        width: 100%;
        color: white;
        font-size: 1.125rem;
        transition: background-color 0.3s ease;
    }

        .btn-add-cart:hover {
            background-color: #e67300;
        }

    .btn-login {
        width: 100%;
        font-weight: 700;
        font-size: 1.125rem;
    }

    .error-message {
        color: red;
        font-weight: 600;
        margin-bottom: 1rem;
    }

    input[type="number"] {
        font-size: 1rem;
        padding: 0.5rem;
        border-radius: 8px;
        border: 1px solid #ccc;
    }

</style>


<div class="product-container">
    <div class="row">
        <!-- Thumbnail nếu có -->
        <!-- Ảnh chính -->
        <div class="col-md-5 text-center">
            <img id="mainProductImage" src="@Model.Product.ImageUrl" class="main-image" alt="Ảnh sản phẩm" />
        </div>

        <!-- Thông tin sản phẩm -->
        <div class="col-md-6 mt-4 mt-md-0">
            <h1 class="product-title">@Model.Product.Name</h1>
            <p class="price">Giá: @Model.Product.Price.ToString("N0") VNĐ</p>
            <p class="category">Thể loại: <span class="fw-normal">@Model.Product.Category?.Name</span></p>

            <!-- Chọn kích thước -->
            <label for="sizeSelect">Chọn kích thước:</label>
            <select id="sizeSelect" class="form-select w-50 mb-3">
                <option value="">-- Chọn kích thước --</option>
                <option value="Nhỏ">Nhỏ</option>
                <option value="Trung bình">Trung bình</option>
                <option value="Lớn">Lớn</option>
            </select>
            <div id="errorSize" class="error-message" style="display:none;">Vui lòng chọn kích thước trước khi thêm vào giỏ.</div>

            <div class="mb-3">
                <label for="quantityInput" class="form-label fw-semibold">Số lượng:</label>
                <input type="number" id="quantityInput" name="Quantity" class="form-control w-50" min="1" max="100" value="@Model.Quantity" required />

            </div>

            <!-- Nút mua hàng -->
            @if (userId != null)
            {
                <form method="post" asp-page-handler="AddToCart" id="addToCartForm">
                    <input type="hidden" name="productId" value="@Model.Product.Id" />
                    <input type="hidden" id="selectedSize" name="selectedSize" />

                    <button type="submit" class="btn-add-cart">
                        THÊM VÀO GIỎ HÀNG <i class="bi bi-cart-plus ms-2"></i>
                    </button>
                </form>
            }
            else
            {
                <a href="/Login" class="btn btn-success btn-login mt-3">
                    ĐĂNG NHẬP ĐỂ MUA HÀNG <i class="bi bi-box-arrow-in-right ms-2"></i>
                </a>
            }
        </div>
    </div>

    <!-- Mô tả chi tiết -->
    <div class="mt-5">
        <h3 class="about-subtitle">Mô tả sản phẩm</h3>
        <ul class="description-list">
            @foreach (var line in Model.Product.Description?.Split('\n') ?? new string[] { })
            {
                if (!string.IsNullOrWhiteSpace(line))
                {
                    <li>@line.TrimStart('-', '–').Trim()</li>
                }
            }
        </ul>
    </div>
</div>


<script>
    // Chọn ảnh thumbnail thay đổi ảnh chính
    function updateMainImage(src, element) {
        document.getElementById('mainProductImage').src = src;
        // Bỏ class selected khỏi tất cả thumbnails
        document.querySelectorAll('.thumbnail-img').forEach(img => img.classList.remove('selected'));
        // Thêm class selected vào ảnh được click
        element.classList.add('selected');
    }

    // Xử lý form submit, bắt buộc chọn size
    document.getElementById('addToCartForm')?.addEventListener('submit', function (e) {
        var size = document.getElementById('sizeSelect').value;
        if (!size) {
            e.preventDefault();
            document.getElementById('errorSize').style.display = 'block';
        } else {
            document.getElementById('errorSize').style.display = 'none';
            document.getElementById('selectedSize').value = size;
        }
    });
</script>


